# 串口驱动WS2812 LED控制器

C# Windows Forms应用程序，用于通过串口驱动WS2812 LED灯带，支持多种显示模式包括音乐频谱可视化、图片显示、自定义绘图等。

## 🎯 功能特性

### 核心功能
- **🎨 自定义绘图**: 8x8和16x16 LED矩阵绘图板，支持实时颜色选择
- **🎵 音乐频谱可视化**: 实时音频FFT分析，频谱显示，支持8x8,16x16以及1x30
- **🖼️ 图片显示**: 支持多种图片格式，支持gif动图
- **⚡ 可拓展其他功能**

## 🛠️ 技术架构

### 开发环境
- .NET Framework 4.8
- Visual Studio项目
- 需要串口设备连接WS2812灯带

### 核心模块
```
├── Form1.cs              # 主窗体，UI界面管理
├── DisplayFunc.cs        # 显示系统核心
├── ws2812_driver.cs      # WS2812串口驱动
├── AudioFFTAnalysis.cs   # 音频FFT分析
├── ImageSettingsForm.cs  # 图片参数设置窗体
└── DisplayConfig.cs      # 灯板配置管理
```

### 显示模式系统
基于`IShowable`接口的插件式架构：
```csharp
public interface IShowable
{
    void show();
}
```

当前支持的显示模式：
- `display_func_draw` - 自定义绘图模式
- `display_music_spectrum` - 音乐频谱可视化  
- `display_func_picture` - 图片显示模式（支持参数调节）

## 🎮 使用方法

### 基本操作
1. **连接串口**: 选择正确的串口号，点击"打开"按钮
2. **调整亮度**: 使用滑动条控制LED亮度(0-100%)，注意亮度过高可能会卡住
3. **选择颜色**: 点击颜色选择按钮设置绘图颜色

### 显示模式切换
- **像素画板**: 切换到绘图模式
- **音乐频谱**: 切换到音乐频谱模式  
- **图片转像素画**: 选择图片并切换到图片显示模式

### 图片转像素画功能
1. 点击**图片转像素画**选择图片文件
2. 自动弹出参数设置窗口
3. 实时调整参数并预览效果：
   - **亮度**: 整体亮度调节
   - **对比度**: 黑白对比度增强
   - **饱和度**: 色彩饱和度调整
   - **黑白阈值**: 二值化阈值控制
   - **强制二值化**: 启用纯黑白模式
4. 点击"应用"确认参数

## 🖼️ 图片处理算法

### 转换流程
1. **双线性插值缩放**: 高质量图像缩放至8x8像素
2. **亮度计算**: 使用标准亮度公式 `0.299R + 0.587G + 0.114B`
3. **极化处理**: 增强对比度，向黑白两极分化
4. **色彩增强**: HSL空间调整饱和度和亮度
5. **二值化选项**: 可选强制黑白模式

### 极化处理参数
```csharp
float threshold = 0.5f;    // 亮度阈值
float contrast = 2.5f;     // 对比度增强系数  
float blackPoint = 0.05f;  // 最小黑电平
float whitePoint = 0.95f;  // 最大白电平
```

## 🎵 音乐频谱功能

### 音频处理
- WASAPI音频捕获
- 1024点FFT频谱分析
- 频率分组
- 动态灵敏度调节

### 视觉效果
- 彩虹色渐变显示
- 峰值白点指示
- 平滑下降动画
- 实时灵敏度显示

## 🔧 硬件连接

### WS2812连接要求
- 数据线连接到串口TX引脚
- 5V电源供电
- 接地连接

## 📁 项目结构

```
串口驱动WS2812/
├── source/                 # 源代码目录
│   ├── Form1.cs           # 主窗体
│   ├── Form1.Designer.cs  # 窗体设计器
│   ├── DisplayFunc.cs     # 显示功能核心
│   ├── ws2812_driver.cs   # WS2812驱动
│   ├── AudioFFTAnalysis.cs # 音频分析
│   ├── ImageSettingsForm.cs # 图片设置
│   └── Properties/        # 项目属性
├── packages/              # NuGet包
└── bin/                   # 编译输出
```

## 🚀 扩展开发

### 添加新显示模式
1. 实现`IShowable`接口
2. 在`display_func_init()`中注册
3. 更新显示模式索引

### 自定义图片处理
修改`EnhanceColor()`方法实现自定义图像处理算法


## 📄 许可证

MIT License - 详见 LICENSE.txt 文件

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 📧 联系

如有问题或建议，请通过项目Issue提交。
